<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://allyoucan.cloud/cdn/icofont/1.0.1/icofont.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">
    <link rel="icon" href="img/favicon.png" type="image/png" />
    <title>Eiser ecommerce</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="vendors/linericon/style.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/themify-icons.css" />
    <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css" />
    <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css" />
    <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css" />
    <link rel="stylesheet" href="vendors/animate-css/animate.css" />
    <link rel="stylesheet" href="vendors/jquery-ui/jquery-ui.css" />
    <!-- main css -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <style>
       
        .container {
            margin-top: 20px;
            background: #eee;
        }

        .nav-borders {
            border-bottom: 1px solid #dee2e6;
        }

        .nav-link {
            margin-left: 0;
        }

        .card {
            background: #ffffff;
            border-radius: 5px;
            border: 0;
            margin-bottom: 1rem;
        }

        .form-control {
            border: 1px solid #cfd1d8;
            border-radius: 2px;
            font-size: 0.825rem;
            background: #ffffff;
            color: #2e323c;
        }

        

        #addressInp::placeholder {
            position: absolute;
            top: 0;
            left: 0;
            padding: 15px;
            color: #6c757d;
        }
    </style>
</head>

<body>

    <div class="container" style="background: #ffffff;">
        <%- include('partials/_header'); %>

        <nav class="nav nav-borders">
            <a class="nav-link active ms-0" href="" target="__blank">Profile</a>
        </nav>

        <div class="row gutters">
            <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="row gutters">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                <h6 class="mb-2 text-primary">Personal Details</h6>
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                <div class="form-group">
                                    <label for="fullName">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" placeholder="Enter full name" value="<%= user.name %>">
                                </div>
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                <div class="form-group">
                                    <label for="eMail">Email</label>
                                    <input type="email" class="form-control" id="eMail" placeholder="Enter email ID"  value="<%= user.email %>" readonly>
                                    
                                </div>
                            </div>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                <div class="form-group">
                                    <label for="phone">Phone</label>
                                    <input type="text" class="form-control" id="phone" placeholder="Enter phone number"  value="<%= user.mobile %>" readonly>
                                </div>
                            </div>
                            
                        </div>

                        <form action="/addAddress" method="post" id="addressForm" onsubmit="return validateForm()">
                            <div class="row gutters">
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                    <h6 class="mt-3 mb-2 text-primary">Address</h6>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="name">Name</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="Name" oninput="validateName(this)">
                                        <small id="nameError" class="text-danger"></small>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="mobile">Mobile Number</label>
                                        <input type="text" class="form-control" id="mobile" name="mobile" placeholder="Mobile number" oninput="validateNumber(this)">
                                        <small id="mobileError" class="text-danger"></small>
                                    </div>
                                </div>
                        
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="pincode">Pincode</label>
                                        <input type="text" class="form-control" id="pincode" name="pincode" placeholder="Pincode" oninput="validateNumber(this)">
                                        <small id="pincodeError" class="text-danger"></small>
                                    </div>
                                </div>
                        
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="locality">Locality</label>
                                        <input type="text" class="form-control" id="locality" name="locality" placeholder="Locality" oninput="validateName(this)">
                                        <small id="localityError" class="text-danger"></small>
                                    </div>
                                </div>
                                <div class="col-xl-12 col-lg-9 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="addressInp">Address</label>
                                        <input type="text" name="address" class="form-control" id="addressInp" placeholder="Address(Area and street)" style="padding: 23px 20px 100px 15px; position: relative; text-align: left;">
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="district">District</label>
                                        <input type="text" class="form-control" id="district" name="district" placeholder="District" oninput="validateName(this)">
                                        <small id="districtError" class="text-danger"></small>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="state">State</label>
                                        <input type="text" class="form-control" id="state" name="state" placeholder="State" oninput="validateName(this)">
                                        <small id="stateError" class="text-danger"></small>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="country">Country</label>
                                        <input type="text" class="form-control" id="country" name="country" placeholder="Country" oninput="validateName(this)">
                                        <small id="countryError" class="text-danger"></small>
                                        <input type="hidden" class="form-control" id="id" name="id">
                                    </div>
                                </div>
                            </div>
                            <div class="row gutters">
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                    <div class="text-right">
                                        <button type="button" class="btn btn-secondary" id="cancelButton">Cancel</button>
                                        <button type="submit" class="btn btn-primary" id="submitButton">Add address</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    </div>



                </div>
            </div>
        </div>
    </div>

    <div class="container"  id="addressList">
        <div class="row">
            <div class="col-md-9">
                <div class="osahan-account-page-right shadow-sm bg-white p-4 h-100">
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade active show" id="addresses" role="tabpanel" aria-labelledby="addresses-tab">
                            <h4 class="font-weight-bold mt-0 mb-4">Manage Addresses</h4>
                            <div class="row">
                                <% addresses.forEach(function(address) { %>
                                    <div class="col-md-6">
                                        <div class="bg-white card addresses-item mb-4 border border-primary shadow">
                                            <div class="gold-members p-4">
                                                <div class="media">
                                                    <div class="mr-3"><i class="icofont-ui-home icofont-3x"></i></div>
                                                    <div class="media-body">
                                                        <h6 class="mb-1 text-secondary"><%= address.name %></h6>
                                                        <p class="text-black"><%= address.address %>, <%= address.locality %>, <%= address.state %>, <%= address.country %>, <%= address.mobile %></p>
                                                        <p class="mb-0 text-black font-weight-bold">
                                                            <a class="text-primary mr-3 edit-address" 
                                                               data-toggle="modal" 
                                                               data-target="#add-address-modal" 
                                                               href="#" 
                                                               data-id="<%= address.id %>"
                                                               data-name="<%= address.name %>"
                                                               data-mobile="<%= address.mobile %>"
                                                               data-country="<%= address.country %>"
                                                               data-state="<%= address.state %>"
                                                               data-district="<%= address.district %>"
                                                               data-locality="<%= address.locality %>"
                                                               data-pincode="<%= address.pincode %>"
                                                               data-address="<%= address.address %>">
                                                               <i class="icofont-ui-edit"></i> EDIT
                                                            </a>
                                                            <a class="text-danger delete-address" data-id="<%= address.id %>" href="#"><i class="icofont-ui-delete"></i> DELETE</a>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>



    <script>
   
   document.addEventListener('DOMContentLoaded', function () {
        var editButtons = document.querySelectorAll('.edit-address');

        editButtons.forEach(function (button) {
            button.addEventListener('click', function (event) {
                // Prevent the default behavior of the anchor tag
                event.preventDefault();

                // Toggle visibility of the address list and form
                document.getElementById('addressList').style.display = 'none';
                document.getElementById('addressForm').style.display = 'block';
                    // Assuming the user ID is stored in a variable on the server and passed to the template
                    // Replace with the correct syntax based on your server-side template engine

                    // Retrieve other details from the button attributes as before
                    var id = button.getAttribute('data-id');
                    var name = button.getAttribute('data-name');
                    var mobile = button.getAttribute('data-mobile');
                    var country = button.getAttribute('data-country');
                    var state = button.getAttribute('data-state');
                    var district = button.getAttribute('data-district');
                    var locality = button.getAttribute('data-locality');
                    var pincode = button.getAttribute('data-pincode');
                    var address = button.getAttribute('data-address');

                    // Populate the form fields with the address details
                    document.getElementById('id').value = id;
                    document.getElementById('name').value = name;
                    document.getElementById('mobile').value = mobile;
                    document.getElementById('pincode').value = pincode;
                    document.getElementById('locality').value = locality;
                    document.getElementById('addressInp').value = address;
                    document.getElementById('district').value = district;
                    document.getElementById('state').value = state;
                    document.getElementById('country').value = country;

                    // Update the form action to handle the update with the retrieved user ID
                    document.getElementById('addressForm').action = '/updateAddress';

                    // Change the button name to "Update Address"
                    document.getElementById('submitButton').innerText = 'Update Address';
                });
            });

            document.getElementById('cancelButton').addEventListener('click', function () {


            document.getElementById('addressList').style.display = 'flex';
                // Reset the form fields
                document.getElementById('name').value = '';
                document.getElementById('mobile').value = '';
                document.getElementById('pincode').value = '';
                document.getElementById('locality').value = '';
                document.getElementById('addressInp').value = '';
                document.getElementById('district').value = '';
                document.getElementById('state').value = '';
                document.getElementById('country').value = '';

                // Reset the form action and button name
                document.getElementById('addressForm').action = '/addAddress';
                document.getElementById('submitButton').innerText = 'Add Address';
            });
        });
    </script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
    var deleteButtons = document.querySelectorAll('.delete-address');

    deleteButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
            event.preventDefault();

            var id = button.getAttribute('data-id');
            fetch('/deleteAddress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: id }),
            })
            .then(response => response.json())
    .then(data => {
        if (data.success) {
            
            console.log(data.message);
            
            window.location.href = "/profile";
        } else {
            console.error(data.message);
        }
    })
    .catch(error => {
        console.error('Error deleting address:', error);
    });
        });
    });
});

</script>

<script>
    function validateForm() {
        const isNameValid = validateName(document.getElementById('name'));
        const isMobileValid = validateNumber(document.getElementById('mobile'));
        const isPincodeValid = validateNumber(document.getElementById('pincode'));
        const isLocalityValid = validateName(document.getElementById('locality'));
        const isDistrictValid = validateName(document.getElementById('district'));
        const isStateValid = validateName(document.getElementById('state'));
        const isCountryValid = validateName(document.getElementById('country'));

        return (
            isNameValid &&
            isMobileValid &&
            isPincodeValid &&
            isLocalityValid &&
            isDistrictValid &&
            isStateValid &&
            isCountryValid
        );
    }

    function validateName(input) {
        const errorId = input.id + 'Error';
        const errorElement = document.getElementById(errorId);
        const regex = /^[a-zA-Z]+(\s[a-zA-Z]+)*$/;

        if (!regex.test(input.value.trim()) || input.value.trim().length === 0) {
            errorElement.textContent = 'Enter a valid input (only letters are allowed, with spaces between words)';
            input.setCustomValidity('Invalid input');
            return false;
        } else {
            errorElement.textContent = '';
            input.setCustomValidity('');
            return true;
        }
    }

    function validateNumber(input) {
        const errorId = input.id + 'Error';
        const errorElement = document.getElementById(errorId);
        const regex = /^[0-9]+$/;

        if (!regex.test(input.value.trim()) || input.value.trim().length === 0) {
            errorElement.textContent = 'Enter a valid number (only digits are allowed)';
            input.setCustomValidity('Invalid number');
            return false;
        } else {
            errorElement.textContent = '';
            input.setCustomValidity('');
            return true;
        }
    }
</script>
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/popper.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/stellar.js"></script>
<script src="vendors/lightbox/simpleLightbox.min.js"></script>
<script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
<script src="vendors/isotope/imagesloaded.pkgd.min.js"></script>
<script src="vendors/isotope/isotope-min.js"></script>
<script src="vendors/owl-carousel/owl.carousel.min.js"></script>
<script src="js/jquery.ajaxchimp.min.js"></script>
<script src="js/mail-script.js"></script>
<script src="vendors/jquery-ui/jquery-ui.js"></script>
<script src="vendors/counter-up/jquery.waypoints.min.js"></script>
<script src="vendors/counter-up/jquery.counterup.js"></script>
<script src="js/theme.js"></script>
</body>


</html>
